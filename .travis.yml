sudo: false
language: node_js
node_js:
- lts/*
services:
- docker
os:
- osx
- linux
before_install:
- |
  if [ $TRAVIS_OS_NAME == "linux" ]; then
    export DISPLAY=':99.0'
    /usr/bin/Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
    sudo apt-get install libsecret-1-dev
  fi
install:
- npm install
- npm install -g vsce
script:
- npm run tslint
- npm run compile
- node scripts/genAiKey.js
- echo "y" | vsce package
- npm test --silent
- |
  if [ $TRAVIS_OS_NAME == "linux" ]; then
    docker run -ti --rm -v $PWD:/mnt:ro dkhamsing/awesome_bot --allow-dupe --allow-redirect --skip-save-results `ls *.md` --white-list gitter.im
  fi
deploy:
- provider: releases
  skip_cleanup: true
  api_key: "$GIT_TOKEN"
  file_glob: true
  file: "*.vsix"
  on:
    tags: true
    condition: "$TRAVIS_OS_NAME == linux"
- provider: script
  skip_cleanup: true
  script: vsce publish -p $VSCE_TOKEN --packagePath *.vsix
  on:
    tags: true
    condition: "$TRAVIS_OS_NAME == linux && $TRAVIS_TAG =~ $ISPRODTAG"
env:
  global:
  - ISPRODTAG=^v?[0-9]+\.[0-9]+\.[0-9]+$
  - secure: Fwx31HtO+6jEytg8pvokuWaMj3slkHCGshMDVqgXYB69x833vYv1coZyEcRERqKECMnbq2v30UbThph7L1Nk0IYGjeLDaetTavHUzeVd+Qv/51r7iZ4KK71pkz0WraGcs6WHOFHhy9bN5qVvc84x8dUck7h9F+emnvMHkLgFle2TN5edb8HNOfdKzMzkk647VuqsKrQxJIOIIAJkiq3sShxXSNpY1Z0HGKw/idCsAcICOMeM5iRUPR4IJM5WCl0MroSLBkTgjEqIqg0MD5DAONIbRRYTbAoN39qoeVOv/Yt5e6k8GhNBcIUB3M4tuTPwXO9j5qc2Sx1IRA/WHAkxdgpK6o3CCQThFHriUXwZrpP5pUK4mAbWfdCK/l4JZJcdkQzkiIsccE1TkgOUMontYIXYmu0hspPC9PhAIXBs3djPw2QZJZIJ0v3ahLTX53Rz4Q6v10HWrmIpk+pJpJmaNQKIZL9XMaTts77xyCy8CK/XWw1gNj4Stohke8mrlYH0OGJ6VZMHz+MMIR0KhSuCMoZ1kAVQ9S3p0akrZdArfVUTWjvaWwAsCzK3vbHr0NsokHPrOymQ49jTbObeN3X4pkfrtkObao7H6NeslEg58AGL98awJuaUMJf980GzXz0jviICC6xWQQ5WFxILA3Ffl0UJkCLRRS+rifMVXFXOsl0=
